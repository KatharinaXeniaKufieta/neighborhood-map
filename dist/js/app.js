var infoWindow,$infoWindowContent=$("#info-window-template");$(document).ready(function(){$("#nav-expander").on("click",function(a){a.preventDefault(),$("body").toggleClass("nav-expanded")}),$("#nav-close").on("click",function(a){a.preventDefault(),$("body").removeClass("nav-expanded")})});var initMap=function(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:36.16,lng:-115.19},zoom:10}),infoWindow=new google.maps.InfoWindow({content:$infoWindowContent[0]}),google.maps.event.addListener(infoWindow,"closeclick",function(){$("body").append($infoWindowContent)})},weather=function(a){var b={url:"//api.openweathermap.org/data/2.5/weather",data:{id:"5506956",units:"imperial",APPID:"868189a81b76adbe0632ec5c77508e39"},dataType:"json",success:function(b){a.weatherData.temp(Math.round(b.main.temp)+"F"),a.weatherData.status(b.weather[0].main),a.weatherData.statusDesc(b.weather[0].description),a.weatherData.windSpeed(b.wind.speed),a.weatherData.humidity(b.main.humidity)}};$.ajax(b)},yelp=function(a,b){function c(){return Math.floor(1e12*Math.random()).toString()}a.yelpData.img(""),a.yelpData.stars(""),a.yelpData.url("");var d="https://api.yelp.com/v2/search",e={oauth_consumer_key:"TaoAvaw-MM7bqlB9PRy8Iw",oauth_token:"NPYotgIFRKcr9Ghi1QXHW4iT-eHiYQOz",oauth_nonce:c(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",location:"Las Vegas",term:b.title(),limit:1,callback:"cb"};e.oauth_signature=oauthSignature.generate("GET",d,e,"VY0siP_qYDDY3PHld3ncpMcynZs","E77kPAX3kUMzjXeHZsXZupO9ApE");var f={url:d,data:e,cache:!0,dataType:"jsonp",success:function(b){a.yelpData.img(b.businesses[0].image_url),a.yelpData.stars(b.businesses[0].rating_img_url_small),a.yelpData.url(b.businesses[0].url)}};$.ajax(f)},markerData=[{name:"Super Summer Theatre",location:{lat:36.0688477,lon:-115.4556288},img:"",blurb:"Come see Broadway shows on stage in a picturesque setting at Spring Mountain Ranch. Bring anumbrella if raining!",info:{indoor:!1,events:!0}},{name:"Sur La Table",location:{lat:36.1389592,lon:-115.3213893},blurb:"Bring your wallet because you will likely spend money!",info:{indoor:!0,events:!1}},{name:"Exploration Peak",location:{lat:36.0172112,lon:-115.2681969},blurb:"Hike up this mini mountain, or better yet run",info:{indoor:!1,events:!1}},{name:"The Cornish Pasty Co.",location:{lat:36.1425409,lon:-115.1447422},blurb:"Just like home!",info:{indoor:!0,events:!1}},{name:"Sam Boyd Stadium",location:{lat:36.0859393,lon:-115.0194987},blurb:"Cheer on the Rebels",info:{indoor:!1,events:!0}},{name:"Thomas & Mack Center",location:{lat:36.1049243,lon:-115.1464457},blurb:"Cheer on the other Rebels!",info:{indoor:!0,events:!0}},{name:"T-Mobile Arena",location:{lat:36.1026098,lon:-115.179217},blurb:"Maybe, just maybe there will be a hockey team here",info:{indoor:!0,events:!0}},{name:"Brooklyn Bowl Las Vegas",location:{lat:36.1175163,lon:-115.1718257},blurb:"Chicken, bowling and rock & roll. What more do you want?",info:{indoor:!0,events:!0}},{name:"Dino's Lounge",location:{lat:36.1525036,lon:-115.1541446},blurb:"Karaoke and beer.",info:{indoor:!0,events:!1}}],viewModel=function(){var a=this;$(document).ajaxError(function(b,c,d){a.error("ERROR: Failed to load data"),console.log(c,d.url)}),a.flightArray=ko.observableArray([]),a.markerPins=ko.observableArray([]),markerData.forEach(function(b){a.markerPins.push(new Marker(b.name,b.location.lat,b.location.lon,b.blurb))}),a.markerPins().forEach(function(b){b.marker.addListener("click",function(){a.openInfoWindow(b)})}),a.isVisibleToggle=function(a){a.isVisible()?a.isVisible(!1):a.isVisible(!0)},a.weatherData={temp:ko.observable(),status:ko.observable(),statusDesc:ko.observable(),windSpeed:ko.observable(),humidity:ko.observable()},a.selected=ko.observable({}),a.yelpData={img:ko.observable(""),stars:ko.observable(""),url:ko.observable("")},a.error=ko.observable(""),a.openInfoWindow=function(b){b.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){b.marker.setAnimation(null)},1500),a.selected(b),yelp(a,b),infoWindow.open(map,b.marker)},a.filterString=ko.observable(),a.filterMarkers=ko.computed(function(){return $("body").append($infoWindowContent),infoWindow.close(),a.markerPins().forEach(function(a){a.isVisible(!1)}),a.filterString()?(result=ko.utils.arrayFilter(a.markerPins(),function(b){return b.title().toLowerCase().indexOf(a.filterString().toLowerCase())>=0}),result.forEach(function(a){a.isVisible(!0)}),result):(a.markerPins().forEach(function(a){a.isVisible(!0)}),a.markerPins())}),weather(a),a.flightModeOn=function(){var b="https://api.flightstats.com/flex/flightstatus/rest/v2/jsonp/flightsNear/36.4/-115.5/36.0/-114.9?appId=92c5ecde&appKey=5d44b9913dfff04d98301c8033c6cc76&maxFlights=15",c={url:b,dataType:"jsonp",jsonpCallback:"cb",success:function(b){for(var c=0;c<a.flightArray().length;c++)a.flightArray()[c].setMap(null);a.flightArray([]);var d="img/plane.png";b.flightPositions.forEach(function(b){a.flightArray.push(new google.maps.Marker({position:{lat:b.positions[0].lat,lng:b.positions[0].lon},map:map,icon:d}))})}};$.ajax(c)},a.flightModeOff=function(){for(var b=0;b<a.flightArray().length;b++)a.flightArray()[b].setMap(null);a.flightArray([])}},Marker=function(a,b,c,d){var e=this;e.title=ko.observable(a),e.blurb=ko.observable(d),e.lat=ko.observable(b),e.lng=ko.observable(c),e.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),animation:google.maps.Animation.DROP}),e.isVisible=ko.observable(!1),e.isVisible.subscribe(function(a){a?e.marker.setMap(map):e.marker.setMap(null)})},init=function(){initMap(),ko.applyBindings(new viewModel)};